---
title: "ìŠ¤í”„ë§ ì‹œíë¦¬í‹° í•µì‹¬ ê°œë…ê³¼ ë¡œê·¸ì¸ êµ¬í˜„ ê°€ì´ë“œ: 2ë¶€ - í•„í„°ì™€ ì˜ˆì™¸ ì²˜ë¦¬"
categories:
  - Spring Security
tags:
  - Spring Security
  - Filters
  - Exception Handling
last_modified_at:
---
#### ğŸ“Œ ìš©ì–´ ì„¤ëª…
- DelegatingFilterProxy: ìŠ¤í”„ë§ ë¹ˆì„ ì„œë¸”ë¦¿ í•„í„°ì— ì—°ê²°. ìŠ¤í”„ë§ ì‹œíë¦¬í‹° í†µí•©
- FilterChainProxy: ë³´ì•ˆ í•„í„° ì²´ì¸ ê´€ë¦¬. ë‹¤ì¤‘ SecurityFilterChain ì‹¤í–‰
- SecurityFilterChain: URL íŒ¨í„´ ë³„ ë³´ì•ˆ í•„í„° ëª©ë¡. ìš”ì²­ ì²˜ë¦¬ ê·œì¹™
- ExceptionTranslationFilter: ë³´ì•ˆ ì˜ˆì™¸ ì²˜ë¦¬. ì¸ì¦/ì¸ê°€ ì˜ˆì™¸ ë¶„ë¦¬
- AuthenticationEntryPoint: ì¸ì¦ ì‹¤íŒ¨ ì²˜ë¦¬. ë¡œê·¸ì¸ í˜ì´ì§€ ì´ë™
- AccessDeniedHandler: ì¸ê°€ ì‹¤íŒ¨ ì²˜ë¦¬. ì ‘ê·¼ ê±°ë¶€ í˜ì´ì§€ í‘œì‹œ
- AbstractAuthenticationProcessingFilter: ì¸ì¦ ì²˜ë¦¬ í•„í„°. ë¡œê·¸ì¸ ìš”ì²­ ì²˜ë¦¬
- AuthorizationManager: ì¸ê°€ ê²°ì • ë¡œì§. ê¶Œí•œ ê²€ì‚¬ ìˆ˜í–‰
- RoleHierarchyVoter: ì—­í•  ê³„ì¸µ ê¸°ë°˜ ì¸ê°€. ìƒìœ„ ì—­í•  ê¶Œí•œ ìƒì†

---
#### ğŸ“Œ í•„í„°ì™€ ì˜ˆì™¸ ì²˜ë¦¬ê°€ ì¤‘ìš”í•œ ì´ìœ 
1. ìš”ì²­ë³„ ë³´ì•ˆ ì²˜ë¦¬. HTTP ìš”ì²­ë§ˆë‹¤ í•„í„° ì ìš©
2. ìœ ì—°í•œ ì¸ì¦/ì¸ê°€ ê´€ë¦¬. í•„í„° ìˆœì„œë¡œ ë¡œì§ ì œì–´
3. ì˜ˆì™¸ ì²˜ë¦¬ í†µí•©. ì¸ì¦/ì¸ê°€ ì‹¤íŒ¨ ì¼ê´€ì„± ìœ ì§€
4. ì»¤ìŠ¤í…€ ë³´ì•ˆ ê°€ëŠ¥. í•„í„° ì¶”ê°€ë¡œ ê¸°ëŠ¥ í™•ì¥
5. ì‚¬ìš©ì ê²½í—˜ ê°œì„ . ì ì ˆí•œ ì˜ˆì™¸ í˜ì´ì§€ ì œê³µ

---
#### ğŸ“Œ í•„í„° ê´€ë ¨ ê°œë… ìƒì„¸
##### 1. DelegatingFilterProxy
- ì„œë¸”ë¦¿ í•„í„°ì™€ ìŠ¤í”„ë§ ë¹ˆ ì—°ê²°
- ìŠ¤í”„ë§ ì‹œíë¦¬í‹° í•„í„°ë¥¼ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì— í†µí•©
- web.xml ë˜ëŠ” Java ì„¤ì •ìœ¼ë¡œ ë“±ë¡
- ì˜ˆ: FilterChainProxyë¥¼ ì„œë¸”ë¦¿ í•„í„°ë¡œ ìœ„ì„

##### 2. FilterChainProxy
- ì—¬ëŸ¬ SecurityFilterChain ê´€ë¦¬
- ìš”ì²­ URLì— ë”°ë¼ ì ì ˆí•œ í•„í„° ì²´ì¸ ì„ íƒ
- ëª¨ë“  ë³´ì•ˆ í•„í„°ì˜ ì§„ì…ì  ì—­í• 
- ì˜ˆ: /admin/**ì™€ /user/**ì— ë‹¤ë¥¸ í•„í„° ì ìš©

##### 3. SecurityFilterChain
- URL íŒ¨í„´ì— ì ìš©ë˜ëŠ” í•„í„° ëª©ë¡
- HttpSecurityë¡œ ë³´ì•ˆ ê·œì¹™ ì •ì˜
- ìš”ì²­ ì²˜ë¦¬ ìˆœì„œ ë³´ì¥
- ì˜ˆ: /api/**ëŠ” ì¸ì¦ í•„ìš”, /public/**ëŠ” ì¸ì¦ ë¶ˆí•„ìš”

##### 4. AbstractAuthenticationProcessingFilter
- ì¸ì¦ ìš”ì²­ ì²˜ë¦¬ ì¶”ìƒ í´ë˜ìŠ¤
- UsernamePasswordAuthenticationFilterê°€ ëŒ€í‘œì 
- ë¡œê·¸ì¸ í¼ ë°ì´í„° ì²˜ë¦¬ ë° ì¸ì¦ ì‹œë„
- ì˜ˆ: /login ìš”ì²­ ì‹œ ì‚¬ìš©ì ì¸ì¦ ìˆ˜í–‰

---
#### ğŸ“Œ ì˜ˆì™¸ ì²˜ë¦¬ ê´€ë ¨ ê°œë… ìƒì„¸
##### 1. ExceptionTranslationFilter
- ì¸ì¦/ì¸ê°€ ì˜ˆì™¸ ì²˜ë¦¬
- AuthenticationException: ì¸ì¦ ì‹¤íŒ¨. AuthenticationEntryPoint í˜¸ì¶œ
- AccessDeniedException: ì¸ê°€ ì‹¤íŒ¨. AccessDeniedHandler í˜¸ì¶œ
- ì˜ˆ: ë¡œê·¸ì¸ ì•ˆ í•œ ì‚¬ìš©ìê°€ /admin ì ‘ì† ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™

##### 2. AuthenticationEntryPoint
- ì¸ì¦ ì‹¤íŒ¨ ì‹œ ë™ì‘ ì •ì˜
- ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ëŠ” 401 ì‘ë‹µ
- ì˜ˆ: ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ ì„¤ì •

##### 3. AccessDeniedHandler
- ì¸ê°€ ì‹¤íŒ¨ ì‹œ ë™ì‘ ì •ì˜
- 403 í˜ì´ì§€ í‘œì‹œ ë˜ëŠ” ì»¤ìŠ¤í…€ ì‘ë‹µ
- ì˜ˆ: ê¶Œí•œ ì—†ëŠ” ì‚¬ìš©ìê°€ /admin ì ‘ì† ì‹œ ì—ëŸ¬ í˜ì´ì§€ í‘œì‹œ

---
#### ğŸ“Œ ì¸ê°€ ê´€ë ¨ ê°œë… ìƒì„¸
##### 1. AuthorizationManager
- ì¸ê°€ ê²°ì • ë¡œì§ êµ¬í˜„
- RequestMatcherë¡œ URL íŒ¨í„´ í™•ì¸
- ê¶Œí•œ ê²€ì‚¬ í›„ ì ‘ê·¼ í—ˆìš©/ê±°ë¶€
- ì˜ˆ: /admin/**ì— ROLE_ADMINë§Œ í—ˆìš©

##### 2. Custom Authorization Managers
- ì»¤ìŠ¤í…€ ì¸ê°€ ë¡œì§ ì‘ì„±
- íŠ¹ì • ì¡°ê±´ì— ë”°ë¥¸ ê¶Œí•œ ê²€ì‚¬
- ì˜ˆ: IP ì£¼ì†Œ ê¸°ë°˜ ì ‘ê·¼ ì œí•œ ì¶”ê°€

##### 3. RoleHierarchyVoter
- ì—­í•  ê³„ì¸µ ê¸°ë°˜ ì¸ê°€
- ìƒìœ„ ì—­í• ì´ í•˜ìœ„ ì—­í•  ê¶Œí•œ ìƒì†
- ì˜ˆ: ROLE_ADMINì€ ROLE_USER ê¶Œí•œ í¬í•¨

---
#### ğŸ“Œ í•„í„°ì™€ ì˜ˆì™¸ ì²˜ë¦¬ ì„¤ì • ì˜ˆì œ
ìŠ¤í”„ë§ ì‹œíë¦¬í‹° í•„í„°ì™€ ì˜ˆì™¸ ì²˜ë¦¬ ì„¤ì •
```java
// ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì„¤ì • í´ë˜ìŠ¤
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    // SecurityFilterChain ì„¤ì •
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            // URLë³„ ì¸ê°€ ì„¤ì •
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/public/**").permitAll() // ê³µê°œ URL í—ˆìš©
                .requestMatchers("/admin/**").hasRole("ADMIN") // ê´€ë¦¬ìë§Œ ì ‘ê·¼
                .anyRequest().authenticated() // ë‚˜ë¨¸ì§€ ìš”ì²­ì€ ì¸ì¦ í•„ìš”
            )
            // í¼ ë¡œê·¸ì¸ ì„¤ì •
            .formLogin(form -> form
                .loginPage("/login") // ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ í˜ì´ì§€
                .permitAll() // ë¡œê·¸ì¸ í˜ì´ì§€ëŠ” ëª¨ë‘ ì ‘ê·¼ ê°€ëŠ¥
            )
            // ì˜ˆì™¸ ì²˜ë¦¬ ì„¤ì •
            .exceptionHandling(ex -> ex
                .authenticationEntryPoint(new CustomAuthenticationEntryPoint()) // ì¸ì¦ ì‹¤íŒ¨ ì²˜ë¦¬
                .accessDeniedHandler(new CustomAccessDeniedHandler()) // ì¸ê°€ ì‹¤íŒ¨ ì²˜ë¦¬
            );
        return http.build();
    }

    // ì»¤ìŠ¤í…€ AuthenticationEntryPoint
    @Component
    public class CustomAuthenticationEntryPoint implements AuthenticationEntryPoint {
        @Override
        public void commence(HttpServletRequest request, HttpServletResponse response,
                             AuthenticationException authException) throws IOException {
            // ì¸ì¦ ì‹¤íŒ¨ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            response.sendRedirect("/login?error=unauthenticated");
        }
    }

    // ì»¤ìŠ¤í…€ AccessDeniedHandler
    @Component
    public class CustomAccessDeniedHandler implements AccessDeniedHandler {
        @Override
        public void handle(HttpServletRequest request, HttpServletResponse response,
                           AccessDeniedException accessDeniedException) throws IOException {
            // ì¸ê°€ ì‹¤íŒ¨ ì‹œ 403 í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            response.sendRedirect("/access-denied");
        }
    }
}
```

ì´ì–´ì„œ "ìŠ¤í”„ë§ ì‹œíë¦¬í‹° í•µì‹¬ ê°œë…ê³¼ ë¡œê·¸ì¸ êµ¬í˜„ ê°€ì´ë“œ: 3ë¶€ - ë¡œê·¸ì¸ ê¸°ëŠ¥ êµ¬í˜„"ì—ì„œ ê³„ì† ì •ë¦¬
