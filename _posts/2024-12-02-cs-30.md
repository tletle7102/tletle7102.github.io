---
title: "N+1 문제 (N+1 Problem)"
categories:
  - CS Basics
tags:
  - CS Basics
last_modified_at: 
---


### N+1 문제 (N+1 Problem)

- **정의**:  
  N+1 문제는 데이터베이스 쿼리에서 발생하는 성능 문제로, 하나의 쿼리로 가져올 수 있는 데이터를 여러 번의 추가적인 쿼리로 나누어 가져오는 상황을 의미한다. 이로 인해 불필요한 데이터베이스 조회가 여러 번 발생하여 성능 저하를 일으킬 수 있다.  
  일반적으로 1개의 객체를 조회한 후, 그 객체와 관련된 N개의 객체를 각각 추가로 조회하는 상황에서 발생한다.

#### 문제 발생 예시
- 예를 들어, **User**와 **Post**가 관계가 있는 데이터베이스 구조가 있다고 가정해본다. User는 여러 개의 Post를 가질 수 있는 관계이다. 만약 사용자별로 포스트를 가져오려 한다면, N+1 문제는 다음과 같이 발생할 수 있다.

##### 단계별 예시:
1. **사용자 목록을 조회**:
    ```sql
    SELECT * FROM Users;  -- 1번 쿼리
    ```

2. **각 사용자의 포스트를 조회**:  
    (각 사용자의 포스트를 조회하기 위해 N번의 쿼리가 추가적으로 발생)
    ```sql
    SELECT * FROM Posts WHERE user_id = 1;  -- 2번 쿼리
    SELECT * FROM Posts WHERE user_id = 2;  -- 3번 쿼리
    SELECT * FROM Posts WHERE user_id = 3;  -- 4번 쿼리
    ```

- 위 예시에서 사용자가 3명이라면, 총 1번의 사용자 쿼리와 3번의 추가 포스트 쿼리가 발생하게 되어 총 4번의 쿼리가 실행된다. 이렇게 N개의 추가 쿼리가 발생하면 성능 문제가 발생한다.

#### 해결 방법
- N+1 문제를 해결하는 방법은 주로 **조인(Join)**을 사용하여 관련 데이터를 한 번에 가져오는 방식이다.

##### 조인 예시:
```sql
SELECT Users.*, Posts.* 
FROM Users
JOIN Posts ON Users.id = Posts.user_id;  -- 조인 쿼리, 1번만 실행
```

### N+1 문제 요약

| **문제**           | **설명**                                                       |
|-----------------|----------------------------------------------------------|
| **정의**           | 1개의 쿼리로 가져올 수 있는 데이터를 여러 번의 추가적인 쿼리로 나누어 조회하는 문제. |
| **문제 발생 예시**    | 하나의 테이블에서 데이터를 조회한 후, 그와 관련된 데이터를 각 행마다 별도의 쿼리로 조회하는 상황. |
| **해결 방법**       | JOIN 쿼리 사용 등으로 관련 데이터를 한 번의 쿼리로 가져와 성능 문제를 해결할 수 있음. |
| **성능 영향**       | 불필요한 데이터베이스 쿼리 실행으로 인해 성능 저하가 발생할 수 있음. |

- N+1 문제는 특히 대규모 데이터베이스에서 성능을 크게 저하시킬 수 있으므로, 이를 해결하기 위한 최적화 방법이 필요하다.
