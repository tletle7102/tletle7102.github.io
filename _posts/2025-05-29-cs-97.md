---
title: "ìŠ¤í”„ë§ ì‹œíë¦¬í‹° í•µì‹¬ ê°œë…ê³¼ ë¡œê·¸ì¸ êµ¬í˜„ ê°€ì´ë“œ: 3ë¶€ - ë¡œê·¸ì¸ ê¸°ëŠ¥ êµ¬í˜„"
categories:
  - Spring Security
tags:
  - Spring Security
  - Login Implementation
  - Authentication
last_modified_at:
---
#### ğŸ“Œ ìš©ì–´ ì„¤ëª…
- UserDetailsService: ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ. DBì—ì„œ ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ
- PasswordEncoder: ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”. ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•œ í•´ì‹œ ì²˜ë¦¬
- UsernamePasswordAuthenticationFilter: í¼ ë¡œê·¸ì¸ ì²˜ë¦¬. ì‚¬ìš©ì ì…ë ¥ ì¸ì¦
- SecurityContextHolder: ì¸ì¦ ì •ë³´ ì €ì¥. ë¡œê·¸ì¸ í›„ ì‚¬ìš©ì ì •ë³´ ìœ ì§€
- HttpSecurity: ë³´ì•ˆ ì„¤ì •. ë¡œê·¸ì¸ ë° URL ì ‘ê·¼ ì œì–´
- AuthenticationManager: ì¸ì¦ ì²˜ë¦¬. ì‚¬ìš©ì ì¸ì¦ ë¡œì§ ì‹¤í–‰

---
#### ğŸ“Œ ë¡œê·¸ì¸ ê¸°ëŠ¥ êµ¬í˜„ ì´ìœ 
1. ì‚¬ìš©ì ì¸ì¦ ì²˜ë¦¬. ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ í•µì‹¬
2. ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ í˜ì´ì§€ ì œê³µ. ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
3. DB ì—°ë™ ì‹¤ìŠµ. ì‹¤ì œ ì‚¬ìš©ì ë°ì´í„° í™œìš©
4. ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì„¤ì • í•™ìŠµ. ì‹¤ë¬´ í™˜ê²½ ì´í•´
5. ë³´ì•ˆ ê¸°ë³¸ê¸° ê°•í™”. ì¸ì¦ íë¦„ ìµíˆê¸°

---
#### ğŸ“Œ ë¡œê·¸ì¸ êµ¬í˜„ ì¤€ë¹„
1. ìŠ¤í”„ë§ ë¶€íŠ¸ í”„ë¡œì íŠ¸ ìƒì„±. Spring Initializr ì‚¬ìš©
2. ì˜ì¡´ì„± ì¶”ê°€. spring-boot-starter-security, spring-boot-starter-web, spring-boot-starter-data-jpa, h2-database
3. H2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •. ë©”ëª¨ë¦¬ DBë¡œ í…ŒìŠ¤íŠ¸
4. ì‚¬ìš©ì ì—”í‹°í‹° ìƒì„±. DBì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
5. ê¸°ë³¸ HTML í…œí”Œë¦¿ ì¤€ë¹„. ë¡œê·¸ì¸ í˜ì´ì§€ ì‘ì„±

---
#### ğŸ“Œ ë¡œê·¸ì¸ ê¸°ëŠ¥ êµ¬í˜„ ë‹¨ê³„
##### 1ë‹¨ê³„: í”„ë¡œì íŠ¸ ì„¤ì •
build.gradleì— ì˜ì¡´ì„± ì¶”ê°€
```java
// ìŠ¤í”„ë§ ë¶€íŠ¸ ë° ì‹œíë¦¬í‹° ì˜ì¡´ì„±
plugins {
    id 'org.springframework.boot' version '3.2.5' // ìŠ¤í”„ë§ ë¶€íŠ¸ í”ŒëŸ¬ê·¸ì¸
    id 'io.spring.dependency-management' version '1.1.6' // ì˜ì¡´ì„± ê´€ë¦¬ í”ŒëŸ¬ê·¸ì¸
    id 'java' // ìë°” í”ŒëŸ¬ê·¸ì¸
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'

repositories {
    mavenCentral() // Maven ì¤‘ì•™ ì €ì¥ì†Œ ì‚¬ìš©
}

dependencies {
    // ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì˜ì¡´ì„±
    implementation 'org.springframework.boot:spring-boot-starter-security'
    // ìŠ¤í”„ë§ ì›¹ ì˜ì¡´ì„±
    implementation 'org.springframework.boot:spring-boot-starter-web'
    // JPAë¥¼ ìœ„í•œ ì˜ì¡´ì„±
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    // H2 ë°ì´í„°ë² ì´ìŠ¤ ì˜ì¡´ì„±
    runtimeOnly 'com.h2database:h2'
    // Thymeleaf í…œí”Œë¦¿ ì—”ì§„ (HTML ë Œë”ë§ìš©)
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
}
```

##### 2ë‹¨ê³„: ì‚¬ìš©ì ì—”í‹°í‹°ì™€ ë¦¬í¬ì§€í† ë¦¬
ì‚¬ìš©ì ì •ë³´ ì €ì¥ ì—”í‹°í‹°ì™€ JPA ë¦¬í¬ì§€í† ë¦¬ ìƒì„±
```java
// ì‚¬ìš©ì ì—”í‹°í‹° í´ë˜ìŠ¤
@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String username; // ì‚¬ìš©ì ì´ë¦„
    private String password; // ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸
    private String role; // ì‚¬ìš©ì ì—­í•  (ì˜ˆ: ROLE_USER)

    // ê¸°ë³¸ ìƒì„±ì
    public User() {}

    // ìƒì„±ì
    public User(String username, String password, String role) {
        this.username = username;
        this.password = password;
        this.role = role;
    }

    // Getter, Setter ìƒëµ
}

// ì‚¬ìš©ì JPA ë¦¬í¬ì§€í† ë¦¬
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    // ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ
    Optional<User> findByUsername(String username);
}
```

##### 3ë‹¨ê³„: UserDetailsService êµ¬í˜„
DBì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
```java
// ì»¤ìŠ¤í…€ UserDetailsService êµ¬í˜„
@Service
public class CustomUserDetailsService implements UserDetailsService {
    @Autowired
    private UserRepository userRepository; // ì‚¬ìš©ì ë¦¬í¬ì§€í† ë¦¬ ì£¼ì…

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        // DBì—ì„œ ì‚¬ìš©ì ì¡°íšŒ
        User user = userRepository.findByUsername(username)
            .orElseThrow(() -> new UsernameNotFoundException("User not found: " + username));
        
        // UserDetails ê°ì²´ ìƒì„±
        return new org.springframework.security.core.userdetails.User(
            user.getUsername(),
            user.getPassword(),
            Collections.singletonList(new SimpleGrantedAuthority(user.getRole()))
        );
    }
}
```

##### 4ë‹¨ê³„: ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì„¤ì •
ë¡œê·¸ì¸ê³¼ URL ì ‘ê·¼ ì œì–´ ì„¤ì •
```java
// ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì„¤ì • í´ë˜ìŠ¤
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Autowired
    private CustomUserDetailsService userDetailsService; // ì»¤ìŠ¤í…€ UserDetailsService ì£¼ì…

    // SecurityFilterChain ì„¤ì •
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            // URLë³„ ì¸ê°€ ì„¤ì •
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/login", "/css/**").permitAll() // ë¡œê·¸ì¸ í˜ì´ì§€, CSS ê³µê°œ
                .requestMatchers("/user/**").hasRole("USER") // ì‚¬ìš©ì í˜ì´ì§€
                .anyRequest().authenticated() // ë‚˜ë¨¸ì§€ ìš”ì²­ì€ ì¸ì¦ í•„ìš”
            )
            // í¼ ë¡œê·¸ì¸ ì„¤ì •
            .formLogin(form -> form
                .loginPage("/login") // ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ í˜ì´ì§€
                .defaultSuccessUrl("/user/dashboard") // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì´ë™
                .permitAll() // ë¡œê·¸ì¸ í˜ì´ì§€ëŠ” ëª¨ë‘ ì ‘ê·¼ ê°€ëŠ¥
            )
            // ë¡œê·¸ì•„ì›ƒ ì„¤ì •
            .logout(logout -> logout
                .logoutUrl("/logout") // ë¡œê·¸ì•„ì›ƒ URL
                .logoutSuccessUrl("/login?logout") // ë¡œê·¸ì•„ì›ƒ í›„ ì´ë™
                .permitAll()
            );
        return http.build();
    }

    // PasswordEncoder ì„¤ì •
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder(); // ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
    }

    // AuthenticationManager ì„¤ì •
    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration config) throws Exception {
        return config.getAuthenticationManager(); // ê¸°ë³¸ AuthenticationManager ì‚¬ìš©
    }
}
```

##### 5ë‹¨ê³„: ë¡œê·¸ì¸ í˜ì´ì§€ HTML
resources/templates/login.htmlì— ë¡œê·¸ì¸ í¼ ì‘ì„±
```java
<!-- ë¡œê·¸ì¸ í˜ì´ì§€ HTML -->
<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <h2>Login</h2>
    <!-- ë¡œê·¸ì¸ í¼ -->
    <form method="post" action="/login">
        <label>Username: <input type="text" name="username"></label><br>
        <label>Password: <input type="password" name="password"></label><br>
        <button type="submit">Login</button>
    </form>
    <!-- ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥ -->
    <c:if test="${param.error != null}">
        <p>Invalid username or password</p>
    </c:if>
    <c:if test="${param.logout != null}">
        <p>Logged out successfully</p>
    </c:if>
</body>
</html>
```

##### 6ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì‚¬ìš©ì ë°ì´í„° ì‚½ì…
```java
// ë°ì´í„° ì´ˆê¸°í™”
@Component
public class DataInitializer implements CommandLineRunner {
    @Autowired
    private UserRepository userRepository;
    @Autowired
    private PasswordEncoder passwordEncoder;

    @Override
    public void run(String... args) throws Exception {
        // í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ì¶”ê°€
        userRepository.save(new User("user", passwordEncoder.encode("password"), "ROLE_USER"));
        userRepository.save(new User("admin", passwordEncoder.encode("admin"), "ROLE_ADMIN"));
    }
}
```

##### 7ë‹¨ê³„: ì»¨íŠ¸ë¡¤ëŸ¬ ì¶”ê°€
ê°„ë‹¨í•œ ì‚¬ìš©ì ëŒ€ì‹œë³´ë“œ í˜ì´ì§€
```java
// ê¸°ë³¸ ì»¨íŠ¸ë¡¤ëŸ¬
@Controller
public class HomeController {
    // ë¡œê·¸ì¸ í˜ì´ì§€
    @GetMapping("/login")
    public String login() {
        return "login"; // login.html ë°˜í™˜
    }

    // ì‚¬ìš©ì ëŒ€ì‹œë³´ë“œ
    @GetMapping("/user/dashboard")
    public String userDashboard() {
        return "dashboard"; // dashboard.html ë°˜í™˜
    }
}
```

---
#### ğŸ“Œ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸
1. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰. Gradleë¡œ ë¹Œë“œ í›„ ì‹¤í–‰
```java
// Gradle ë¹Œë“œ ë° ì‹¤í–‰ ëª…ë ¹
./gradlew build
./gradlew bootRun
```
2. ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8080/login ì ‘ì†
3. username: user, password: passwordë¡œ ë¡œê·¸ì¸
4. ë¡œê·¸ì¸ ì„±ê³µ ì‹œ /user/dashboardë¡œ ì´ë™
5. /logoutìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒ í…ŒìŠ¤íŠ¸
6. H2 ì½˜ì†”(http://localhost:8080/h2-console)ë¡œ DB í™•ì¸

---
#### âœ ë¡œê·¸ì¸ êµ¬í˜„ í•™ìŠµ íŒ
1. ê°„ë‹¨í•œ ì„¤ì •ë¶€í„° ì‹œì‘. ì¸ë©”ëª¨ë¦¬ DBë¡œ í…ŒìŠ¤íŠ¸
2. ë””ë²„ê¹…ìœ¼ë¡œ í•„í„° íë¦„ í™•ì¸. UsernamePasswordAuthenticationFilter ë™ì‘ ì´í•´
3. ê³µì‹ ë¬¸ì„œ ì°¸ê³ . ìŠ¤í”„ë§ ì‹œíë¦¬í‹° 6.x ë¡œê·¸ì¸ ì„¤ì •
4. ì»¤ìŠ¤í…€ í˜ì´ì§€ ì‹¤ìŠµ. ë¡œê·¸ì¸ í¼ ë””ìì¸ ë³€ê²½
5. ì—ëŸ¬ ì²˜ë¦¬ ì¶”ê°€. ì»¤ìŠ¤í…€ ì—ëŸ¬ ë©”ì‹œì§€ êµ¬í˜„
